{
  "openapi": "3.0.0",
  "info": {
    "title": "E-Commerce Backend API",
    "version": "1.0.0",
    "description": "API para e-commerce con auth JWT y MongoDB"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api"
    }
  ],
  "components": {
    "securitySchemes": {
      "schemas": {
        "User": {
          "type": "object",
          "properties": {
            "_id": {
              "type": "string",
              "example": "65b1c97f2fcf0b1234abcd89"
            },
            "name": {
              "type": "string",
              "example": "Juan Pérez"
            },
            "email": {
              "type": "string",
              "format": "email",
              "example": "juan@example.com"
            },
            "createdAt": {
              "type": "string",
              "format": "date-time",
              "example": "2025-01-15T12:34:56.789Z"
            },
            "updatedAt": {
              "type": "string",
              "format": "date-time",
              "example": "2025-01-15T12:34:56.789Z"
            }
          }
        }
      },
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "accessToken",
        "description": "JWT Access Token en cookie"
      }
    }
  },
  "paths": {
    "/auth/me": {
      "get": {
        "tags": ["Auth"],
        "summary": "Obtener información del usuario autenticado",
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Usuario autenticado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": { "type": "string" },
                    "email": { "type": "string" },
                    "name": { "type": "string" }
                  }
                },
                "example": {
                  "id": "64f9e91234abc9123f0001d4",
                  "email": "usuario@example.com",
                  "name": "Juan Pérez"
                }
              }
            }
          },
          "401": {
            "description": "No autenticado (falta o expira el JWT)"
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "summary": "Registra un nuevo usuario en el sistema",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "email",
                  "password"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Nombre del usuario",
                    "example": "Juan Pérez"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email único del usuario",
                    "example": "juan@example.com"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 6,
                    "description": "Contraseña (mínimo 6 caracteres)",
                    "example": 123456
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario registrado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Usuario registrado exitosamente"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Datos inválidos o email ya registrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Datos invalidos. La longitud minima de la conteaseña es de 6 caracteres."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error del servidor"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Inicia sesión, genera tokens JWT y los envía en cookies HTTP-only",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "juan@example.com"
                  },
                  "password": {
                    "type": "string",
                    "example": "123456"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login exitoso. Las cookies accessToken y refreshToken se envían automáticamente.",
            "headers": {
              "Set-Cookie": {
                "description": "Cookies: accessToken (HTTP-only, expira en 15m) y refreshToken (HTTP-only, expira en 7 días). Ambas con SameSite=None y secure=true en producción.",
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Login exitoso"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "string" },
                        "name": { "type": "string" },
                        "email": { "type": "string" }
                      },
                      "example": {
                        "id": "65b1c97f2fcf0b1234abcd89",
                        "name": "Juan Pérez",
                        "email": "juan@example.com"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Datos inválidos o credenciales incorrectas",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Credenciales inválidas."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error del servidor"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "summary": "Cierra sesión y limpia cookies de tokens",
        "tags": [
          "Auth"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logout exitoso (cookies limpias)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Logout Exitoso"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado (sin token válido)"
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "summary": "Refresca el accessToken usando refreshToken",
        "tags": [
          "Auth"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Token refrescado (nuevo accessToken en cookie)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Token refrescado !"
                    }
                  }
                }
              }
            },
            "headers": {
              "Set-Cookie": {
                "description": "Nuevo accessToken (expira en 15m)",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "No hay refreshToken",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "No hay refresh token."
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "RefreshToken inválido",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Refresh token invalido"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error del servidor (implícito)"
          }
        }
      }
    },
    "/cart": {
      "get": {
        "summary": "Obtiene el carrito del usuario autenticado (poblado con productos)",
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Carrito del usuario (o {items: []} si vacío)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "user": {
                      "type": "string"
                    },
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "product": {
                            "type": "object",
                            "properties": {
                              "_id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "price": {
                                "type": "number"
                              }
                            }
                          },
                          "quantity": {
                            "type": "number",
                            "example": 1
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "500": {
            "description": "Error al obtener el carrito",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al obtener el carrito"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cart/add": {
      "post": {
        "summary": "Agrega o incrementa un item en el carrito",
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "productId",
                  "quantity"
                ],
                "properties": {
                  "productId": {
                    "type": "string",
                    "description": "ID del producto (ObjectId)",
                    "example": "507f1f77bcf86cd799439011"
                  },
                  "quantity": {
                    "type": "number",
                    "minimum": 1,
                    "example": 2
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Carrito actualizado (poblado)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "product": {
                            "type": "object"
                          },
                          "quantity": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "ProductId y cantidad (min. 1) son requeridos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "ProductID y cantidad (min. 1) son requeridos"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "404": {
            "description": "Producto no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Producto no encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al agregar al carrito",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al agregar al carrito"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cart/update": {
      "put": {
        "summary": "Actualiza la cantidad de un item en el carrito",
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "productId",
                  "quantity"
                ],
                "properties": {
                  "productId": {
                    "type": "string",
                    "example": "507f1f77bcf86cd799439011"
                  },
                  "quantity": {
                    "type": "number",
                    "minimum": 1,
                    "example": 3
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Carrito actualizado (poblado)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "product": {
                            "type": "object"
                          },
                          "quantity": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "ProductId y cantidad (mín. 1) son requeridos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "ProductId y cantidad (mín. 1) son requeridos."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "404": {
            "description": "Carrito o item no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Item no encontrado en el carrito."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al actualizar el carrito",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al actualizar el carrito"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cart/remove/{productId}": {
      "delete": {
        "summary": "Elimina un item del carrito por ID de producto",
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "productId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID del producto a remover (ObjectId)",
            "example": "507f1f77bcf86cd799439011"
          }
        ],
        "responses": {
          "200": {
            "description": "Carrito actualizado (poblado, item removido)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "product": {
                            "type": "object"
                          },
                          "quantity": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "404": {
            "description": "Carrito no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Carrito no encontrado."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al eliminar el producto del carrito",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al eliminar el producto del carrito"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/products": {
      "get": {
        "summary": "Lista todos los productos",
        "tags": [
          "Products"
        ],
        "responses": {
          "200": {
            "description": "Lista de productos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "_id": {
                        "type": "string"
                      },
                      "name": {
                        "type": "string",
                        "example": "Laptop"
                      },
                      "description": {
                        "type": "string"
                      },
                      "price": {
                        "type": "number",
                        "example": 999.99
                      },
                      "stock": {
                        "type": "number",
                        "example": 10
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al obtener los productos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al obtener los productos"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Crea un nuevo producto",
        "tags": [
          "Products"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "price"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "Laptop"
                  },
                  "description": {
                    "type": "string",
                    "example": "Laptop gaming"
                  },
                  "price": {
                    "type": "number",
                    "example": 999.99
                  },
                  "stock": {
                    "type": "number",
                    "example": 10
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Producto creado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Nombre y precio son requeridos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Nombre y precio son requeridos"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado (sin token válido)"
          },
          "500": {
            "description": "Error al crear el producto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al crear el producto"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/products/{id}": {
      "get": {
        "summary": "Obtiene un producto por ID",
        "tags": [
          "Products"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID del producto (ObjectId de MongoDB)",
            "example": "507f1f77bcf86cd799439011"
          }
        ],
        "responses": {
          "200": {
            "description": "Detalle del producto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "price": {
                      "type": "number"
                    },
                    "stock": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Producto no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Producto no encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al obtener el producto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al obtener el producto"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Actualiza un producto por ID",
        "tags": [
          "Products"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "example": "507f1f77bcf86cd799439011"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "price": {
                    "type": "number"
                  },
                  "stock": {
                    "type": "number"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Producto actualizado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "_id": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "404": {
            "description": "Producto no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Producto no encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al actualizar el producto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al actualizar el producto"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Elimina un producto por ID",
        "tags": [
          "Products"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "example": "507f1f77bcf86cd799439011"
          }
        ],
        "responses": {
          "200": {
            "description": "Producto eliminado correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Producto eliminado correctamente"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Acceso denegado"
          },
          "404": {
            "description": "Producto no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Producto no encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al eliminar el producto",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Error al eliminar el producto"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Auth",
      "description": "Operaciones de autenticación de usuarios"
    },
    {
      "name": "Cart",
      "description": "Gestión del carrito de compras del usuario autenticado"
    },
    {
      "name": "Products",
      "description": "Operaciones CRUD de productos"
    }
  ]
}